<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">

    <title>Waggle</title>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css" rel="stylesheet">


    <style>
        a {
            color: inherit;
            text-decoration: none;
        }

        body {
            font-family: Arial, sans-serif;
        }

        #calendar {
            max-width: 900px;
            margin: 0 auto;
        }

        #eventModal {
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 700px;
            height: 500px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    </style>
</head>
<body>

<th:block th:replace="fragments/header.html :: fragment-header"></th:block>

<div id="calendar"></div>

<div id="eventModal">
    <div class="modal-content">
        <div class="modal-header"style="margin-bottom: 20px; margin-left: 30px; margin-top: 25px; width: 640px">
            <input type="text" id="eventTitle" name="eventTitle" style="font-weight: bold; font-size: 30px;">
        </div>
        <div class="modal-body">
            <div class="form-group" style="margin-bottom: 20px; margin-left: 30px;">
                <label for="eventStartTime" style="margin-right: 10px;">날짜</label>
                <input class="form-control" type="datetime-local" id="eventStartTime" name="eventStartTime">
            </div>
            <div class="form-group"style="margin-bottom: 20px; margin-left: 30px;">
                <label for="eventScheduleMembers" style="margin-right: 10px;">담당자</label>
                <input class="form-control" type="text" id="eventScheduleMembers" name="eventScheduleMembers">
            </div>
            <div class="form-group"style="margin-bottom: 20px; margin-left: 30px; margin-right: 30px">
                <textarea class="form-control" type="text" id="eventDescription" name="eventDescription" style="height: 300px; width: 640px"></textarea>
            </div>
        </div>

    </div>
</div>

<script th:inline="javascript">
    var schedules = /*[[${scheduleDtos}]]*/ [];

    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            // FullCalendar 설정 옵션들
            initialView: 'dayGridMonth',
            events: schedules.map(function (schedule) {
                return {
                    id: schedule.id,
                    title: schedule.title,
                    start: schedule.scheduleTime,
                    description: schedule.description,
                    scheduleMembers: schedule.scheduleMembers,
                };
            }),
            eventClick: function (info) {
                var event = info.event;
                $('#eventTitle').val(event.title);
                $('#eventStartTime').val(moment(event.start).format('YYYY-MM-DDTHH:mm')); // 날짜 형식을 맞게 조정해야 할 수도 있습니다.
                $('#eventDescription').val(event.description);
                $('#eventScheduleMembers').val(event.scheduleMembers);

                // 모달을 띄웁니다.
                $('#eventModal').modal('show');
            }
        });

        calendar.render();
    });


    $('#eventModal').on('hidden.bs.modal', function () {
        if (editedEvent) {
            var updatedEvent = {
                id: editedEvent.id,
                teamId: editedEvent.teamId,
                title: $('#eventTitle').val(),
                description: $('#eventDescription').val(),
                scheduleTime: $('#eventStartTime').val(),
                scheduleMembers: $('#eventScheduleMembers').val().split(',')
            };

            $.ajax({
                url: '/schedule/update/' + updatedEvent.id,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(updatedEvent),
                success: function (response) {
                    // 서버 응답 처리 (선택)
                },
                error: function (xhr, status, error) {
                    // 오류 처리 (선택)
                }
            });
        }
        editedEvent = null;
    });



</script>
</body>
</html>